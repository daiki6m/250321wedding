<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dog Soccer Striker (PC/Mobile)</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #2e7d32;
            font-family: 'Arial Black', sans-serif;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: default;
            /* åˆæœŸçŠ¶æ…‹ */
        }

        /* ã‚²ãƒ¼ãƒ ä¸­ã¯ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ¶ˆã™ã‚¯ãƒ©ã‚¹ */
        .no-cursor {
            cursor: none !important;
        }

        /* UIãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        /* ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ */
        .scoreboard {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 8px 30px;
            border-radius: 0 0 15px 15px;
            border: 2px solid #666;
            border-top: none;
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            gap: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            pointer-events: none;
        }

        .score-box {
            text-align: center;
        }

        .label {
            font-size: 0.7rem;
            color: #aaa;
            display: block;
            margin-bottom: 2px;
            letter-spacing: 1px;
        }

        .val {
            font-size: 2.2rem;
            color: #ffeb3b;
            text-shadow: 0 0 10px rgba(255, 235, 59, 0.5);
        }

        .panel {
            background: rgba(255, 255, 255, 0.98);
            border: 6px solid #1b5e20;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            pointer-events: auto;
            max-width: 90%;
            width: 420px;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        h1 {
            margin: 0 0 10px 0;
            color: #1b5e20;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        p {
            color: #444;
            margin-bottom: 20px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* ãƒœã‚¿ãƒ³å…±é€š */
        button {
            border: none;
            border-radius: 50px;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
            transition: transform 0.1s, box-shadow 0.1s;
            color: #fff;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(3px);
        }

        button:hover {
            filter: brightness(1.1);
        }

        /* é›£æ˜“åº¦ãƒœã‚¿ãƒ³ */
        .diff-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            margin-bottom: 15px;
        }

        .btn-easy {
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            box-shadow: 0 4px 0 #33691E;
            padding: 15px;
            font-size: 1.2rem;
        }

        .btn-easy:active {
            box-shadow: 0 2px 0 #33691E;
        }

        .btn-normal {
            background: linear-gradient(to right, #FF9800, #FFC107);
            box-shadow: 0 4px 0 #E65100;
            padding: 15px;
            font-size: 1.2rem;
        }

        .btn-normal:active {
            box-shadow: 0 2px 0 #E65100;
        }

        .btn-hard {
            background: linear-gradient(to right, #F44336, #FF5252);
            box-shadow: 0 4px 0 #B71C1C;
            padding: 15px;
            font-size: 1.2rem;
        }

        .btn-hard:active {
            box-shadow: 0 2px 0 #B71C1C;
        }

        /* ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ */
        #retryBtn {
            background: linear-gradient(to bottom, #2196F3, #42A5F5);
            box-shadow: 0 5px 0 #0D47A1;
            padding: 18px 50px;
            font-size: 1.4rem;
            width: 100%;
        }

        #retryBtn:active {
            box-shadow: 0 2px 0 #0D47A1;
        }


        .control-hint {
            margin-top: 10px;
            font-size: 0.8rem;
            color: #666;
            background: #eee;
            padding: 8px;
            border-radius: 8px;
            display: inline-block;
        }

        .key {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 2px 6px;
            margin: 0 2px;
            font-family: monospace;
            font-weight: bold;
            box-shadow: 0 2px 0 #ddd;
        }

        .hidden {
            display: none !important;
        }

        /* ã‚´ãƒ¼ãƒ«æ¼”å‡º */
        #goal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            z-index: 20;
            opacity: 0;
            transition: opacity 0.2s;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(2px);
        }

        .show-goal {
            opacity: 1 !important;
        }

        .goal-text {
            font-size: 5rem;
            color: #fff;
            font-weight: 900;
            text-shadow: 0 0 30px #e65100, 5px 5px 0 #bf360c;
            margin-bottom: 10px;
            font-style: italic;
        }

        .points-text {
            font-size: 7rem;
            color: #ffeb3b;
            font-weight: 900;
            text-shadow: 5px 5px 0 #f57f17;
            animation: pulse 0.4s infinite alternate;
        }

        @keyframes pulse {
            from {
                transform: scale(1);
            }

            to {
                transform: scale(1.1);
            }
        }

        /* ã‚»ãƒªãƒ•å¹ãå‡ºã— */
        .speech-bubble {
            position: absolute;
            background: #fff;
            border: 3px solid #333;
            border-radius: 15px;
            padding: 10px 20px;
            font-weight: bold;
            color: #333;
            font-size: 1.4rem;
            pointer-events: none;
            white-space: nowrap;
            z-index: 30;
            opacity: 0;
            transform: translate(-50%, 0) scale(0.8);
            transition: opacity 0.2s, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.2);
            font-family: "Hiragino Maru Gothic Pro", "Yu Gothic", sans-serif;
        }

        .show-bubble {
            opacity: 1;
            transform: translate(-50%, 0) scale(1);
        }

        /* CPUç”¨ï¼ˆã—ã£ã½ä¸Šï¼‰ */
        .bubble-cpu {
            transform-origin: center top;
        }

        .bubble-cpu::after {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 0 12px 12px;
            border-style: solid;
            border-color: transparent transparent #333 transparent;
        }

        .bubble-cpu::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 0 9px 9px;
            border-style: solid;
            border-color: transparent transparent #fff transparent;
            z-index: 1;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”¨ï¼ˆã—ã£ã½ä¸‹ï¼‰ */
        .bubble-player {
            transform-origin: center bottom;
        }

        .bubble-player::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 12px 12px 0;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .bubble-player::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 9px 9px 0;
            border-style: solid;
            border-color: #fff transparent transparent transparent;
            z-index: 1;
        }
    </style>
</head>

<body>

    <canvas id="gameCanvas"></canvas>

    <div class="scoreboard">
        <div class="score-box">
            <span class="label">CPU</span>
            <span id="scoreCPU" class="val">0</span>
        </div>
        <div style="font-size: 2rem; color:#777; align-self:center; margin-top:-5px;">-</div>
        <div class="score-box">
            <span class="label">YOU</span>
            <span id="scorePlayer" class="val">0</span>
        </div>
    </div>

    <div id="goal-overlay">
        <div class="goal-text" id="goalTitle">GOAL!</div>
        <div class="points-text" id="goalPoints">+1</div>
    </div>

    <!-- å¹ãå‡ºã—ç”¨ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="cpuSpeech" class="speech-bubble bubble-cpu hidden"></div>
    <div id="playerSpeech" class="speech-bubble bubble-player hidden"></div>

    <div id="ui-layer">
        <div id="menu-screen" class="panel">
            <h1>Dog Soccer<br>Striker</h1>
            <p>
                ä¸­å¤®ã®ã‚´ãƒ¼ãƒ«ã§ <span style="color:#e65100; font-weight:bold; font-size:1.1em;">2ç‚¹</span><br>
                ãã‚Œä»¥å¤–ã¯ <span style="color:#555; font-weight:bold;">1ç‚¹</span><br>
                å…ˆã« <b>10ç‚¹</b> å–ã£ãŸæ–¹ã®å‹ã¡ï¼
            </p>

            <!-- é›£æ˜“åº¦é¸æŠãƒœã‚¿ãƒ³ -->
            <div class="diff-buttons">
                <button onclick="startGame('easy')" class="btn-easy">ã‹ã‚“ãŸã‚“</button>
                <button onclick="startGame('normal')" class="btn-normal">ãµã¤ã†</button>
                <button onclick="startGame('hard')" class="btn-hard">ã‚€ãšã‹ã—ã„</button>
            </div>

            <div class="control-hint">
                æ“ä½œ: ãƒã‚¦ã‚¹ ã¾ãŸã¯ <span class="key">â†</span><span class="key">â†’</span><span class="key">â†‘</span><span
                    class="key">â†“</span>
            </div>
        </div>

        <div id="game-over-screen" class="panel hidden">
            <h1 id="result-title">YOU WIN!</h1>
            <p>FINAL SCORE<br>
                <span style="font-size: 2.5rem; font-weight:bold; color:#333;">
                    <span id="resPlayer">0</span> - <span id="resCPU">0</span>
                </span>
            </p>
            <button id="retryBtn">PLAY AGAIN</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const menuScreen = document.getElementById('menu-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const goalOverlay = document.getElementById('goal-overlay');
        const goalTitle = document.getElementById('goalTitle');
        const goalPoints = document.getElementById('goalPoints');
        const cpuSpeechBubble = document.getElementById('cpuSpeech');
        const playerSpeechBubble = document.getElementById('playerSpeech');

        const scorePlayerEl = document.getElementById('scorePlayer');
        const scoreCPUEl = document.getElementById('scoreCPU');
        const resPlayerEl = document.getElementById('resPlayer');
        const resCPUEl = document.getElementById('resCPU');

        // --- ç”»åƒã‚¢ã‚»ãƒƒãƒˆè¨­å®š ---
        const DOG1_SRC = "Nemo.png";   // ã‚ãªãŸã®æ“ä½œã™ã‚‹çŠ¬ (HOME/YOU)
        const DOG2_SRC = "Shumo.png";  // ç›¸æ‰‹ã®çŠ¬ (AWAY/CPU)

        const BALL_SRC = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Ccircle cx='30' cy='30' r='28' fill='white' stroke='black' stroke-width='2'/%3E%3Cpath d='M30 2 L38 18 L56 18 L42 30 L48 48 L30 38 L12 48 L18 30 L4 18 L22 18 Z' fill='black'/%3E%3C/svg%3E";

        const imgDog1 = new Image(); imgDog1.src = DOG1_SRC;
        const imgDog2 = new Image(); imgDog2.src = DOG2_SRC;
        const imgBall = new Image(); imgBall.src = BALL_SRC;

        const fallbackSrc = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23ccc' stroke='black' stroke-width='2'/%3E%3Ctext x='50' y='55' font-size='14' text-anchor='middle' fill='black'%3ENo Image%3C/text%3E%3C/svg%3E";
        imgDog1.onerror = () => { imgDog1.src = fallbackSrc; console.warn("Nemo.png not found"); };
        imgDog2.onerror = () => { imgDog2.src = fallbackSrc; console.warn("Shumo.png not found"); };


        // ã‚²ãƒ¼ãƒ è¨­å®š
        const TARGET_SCORE = 10;
        const GOAL_WIDTH = 140;

        let gameState = 'menu';
        let difficulty = 'normal'; // easy, normal, hard

        const ball = { x: 0, y: 0, vx: 0, vy: 0, r: 20, angle: 0 };
        const player = { x: 0, y: 0, r: 50, score: 0 };
        const cpu = { x: 0, y: 0, r: 50, score: 0 };

        let confettis = [];

        // --- ã‚»ãƒªãƒ•é›† ---
        // CPUãŒå¤±ç‚¹ã—ãŸæ™‚ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå¾—ç‚¹ï¼‰
        const cpuSadPhrases = [
            "ã‚ãƒ¼ã£ï¼", "ã‚„ã‚ã¦ãƒ¼ï¼", "ã†ããƒ¼ã‚“", "ã¾ã˜ã‹...", "å®ˆã‚Œãªã„ï¼",
            "æ¬¡ã¯æ­¢ã‚ã‚‹ï¼", "ãã‚„ã—ã€œ", "ã†ã‚ããã‚“ğŸ˜­", "ãªã‚“ã§ãƒ¼ï¼ï¼Ÿ", "å¼·ã„..."
        ];
        // CPUãŒå¾—ç‚¹ã—ãŸæ™‚ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå¤±ç‚¹ï¼‰
        const cpuHappyPhrases = [
            "ã‚ˆã£ã—ã‚ƒï¼", "ã‚¤ã‚¨ãƒ¼ã‚¤ï¼", "ã‚‚ã‚‰ã£ãŸï¼", "ã‚´ãƒ¼ãƒ«ï¼", "è¦‹ãŸã‹ï¼"
        ];

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå¾—ç‚¹ã—ãŸæ™‚ï¼ˆå–œã³ï¼‰
        const playerHappyPhrases = [
            "ã‚„ã£ãŸãƒ¼ï¼", "ãƒŠã‚¤ã‚¹ï¼", "ã‚¤ã‚¨ãƒ¼ã‚¤ï¼", "æ±ºã¾ã£ãŸï¼", "æ¥½å‹ï¼",
            "æœ€é«˜ï¼", "å®Œç’§ï¼", "è¦‹ãŸï¼ï¼Ÿ", "å¤©æ‰ï¼", "ã‚ãƒ¼ã„ï¼"
        ];
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå¤±ç‚¹ã—ãŸæ™‚ï¼ˆæ‚”ã—ã•ï¼‰
        const playerSadPhrases = [
            "ã‚ãƒ¼ã£ï¼", "ãããƒ¼ï¼", "ã—ã¾ã£ãŸï¼", "ã‚„ã‚‰ã‚ŒãŸ...", "ã‚ã¶ãªã„ï¼",
            "ã†ãã§ã—ã‚‡", "æ¬¡ã¯æ±ºã‚ã‚‹", "ãƒ‰ãƒ³ãƒã‚¤", "ã†ã‚ãƒ¼ã‚“",
            "ã‚·ãƒ¥ãƒ¢ã®ãã›ã«ç”Ÿæ„æ°—ã ãƒ¼" // â˜… è¿½åŠ ã•ã‚ŒãŸã‚»ãƒªãƒ•
        ];

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ç®¡ç†
        const keys = {
            ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false,
            w: false, a: false, s: false, d: false,
            W: false, A: false, S: false, D: false
        };

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (gameState === 'menu') resetPositions();
        }
        window.addEventListener('resize', resize);

        function resetPositions() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.vx = 0;
            ball.vy = 0;
            ball.angle = 0;

            player.x = canvas.width / 2;
            player.y = canvas.height - 150;

            cpu.x = canvas.width / 2;
            cpu.y = 150;
        }

        // å¼•æ•°ã§é›£æ˜“åº¦ã‚’å—ã‘å–ã‚‹
        function startGame(diff) {
            difficulty = diff || 'normal';
            player.score = 0;
            cpu.score = 0;
            updateScoreBoard();
            resize();
            resetPositions();

            gameState = 'playing';
            menuScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            canvas.classList.add('no-cursor');

            loop();
        }

        function updateScoreBoard() {
            scorePlayerEl.innerText = player.score;
            scoreCPUEl.innerText = cpu.score;
        }

        // --- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
        function update() {
            if (gameState !== 'playing') return;

            // 1. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå‡¦ç†
            const speed = 8;
            if (keys.ArrowLeft || keys.a || keys.A) player.x -= speed;
            if (keys.ArrowRight || keys.d || keys.D) player.x += speed;
            if (keys.ArrowUp || keys.w || keys.W) player.y -= speed;
            if (keys.ArrowDown || keys.s || keys.S) player.y += speed;

            // 2. ãƒœãƒ¼ãƒ«ç‰©ç†
            ball.x += ball.vx;
            ball.y += ball.vy;
            ball.vx *= 0.98; // æ‘©æ“¦
            ball.vy *= 0.98;

            const ballSpeed = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
            ball.angle += ballSpeed * 0.1;

            // å£åå°„
            if (ball.x - ball.r < 0) { ball.x = ball.r; ball.vx *= -0.8; }
            if (ball.x + ball.r > canvas.width) { ball.x = canvas.width - ball.r; ball.vx *= -0.8; }

            // å¾—ç‚¹åˆ¤å®š
            if (ball.y < -ball.r) checkGoalScore('player');
            else if (ball.y > canvas.height + ball.r) checkGoalScore('cpu');

            // 3. CPU AI
            // é›£æ˜“åº¦ã«ã‚ˆã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´
            let aiSpeedBase = 4.0;
            let reactionDist = 0; // åå¿œè·é›¢ï¼ˆå¤§ãã„ã»ã©æ—©ãåå¿œã™ã‚‹ï¼‰

            if (difficulty === 'easy') {
                aiSpeedBase = 2.5;
                reactionDist = -50; // è¿‘ã¥ã‹ãªã„ã¨åå¿œã—ãªã„
            } else if (difficulty === 'normal') {
                aiSpeedBase = 4.0;
                reactionDist = 0;
            } else if (difficulty === 'hard') {
                aiSpeedBase = 5.5;
                reactionDist = 100; // é ãã¦ã‚‚åå¿œã™ã‚‹
            }

            // è² ã‘ã¦ã‚‹ã¨å°‘ã—æœ¬æ°—å‡ºã™ï¼ˆãƒãƒ³ãƒ‡è£œæ­£ï¼‰
            if (player.score > cpu.score) aiSpeedBase += 1.0;

            const homeX = canvas.width / 2;
            const homeY = 100;

            // ãƒœãƒ¼ãƒ«ãŒè‡ªåˆ†ã®ã‚³ãƒ¼ãƒˆ(ä¸ŠåŠåˆ† + reactionDist)ã«ã‚ã‚‹ãªã‚‰åå¿œ
            if (ball.y < canvas.height * 0.6 + reactionDist) {
                const dx = ball.x - cpu.x;
                const dy = (ball.y - 20) - cpu.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                // easyã®å ´åˆã¯å°‘ã—åå¿œã‚’éˆãã™ã‚‹ï¼ˆè·é›¢ãŒã‚ã£ã¦ã‚‚å‹•ã‹ãªã„å ´åˆã‚’ä½œã‚‹ï¼‰
                if (dist > 5) {
                    cpu.x += (dx / dist) * aiSpeedBase;
                    cpu.y += (dy / dist) * aiSpeedBase;
                }
            } else {
                // å®šä½ç½®ã«æˆ»ã‚‹
                cpu.x += (homeX - cpu.x) * 0.08;
                cpu.y += (homeY - cpu.y) * 0.08;
            }

            // 4. è¡çªåˆ¤å®š
            checkCollision(player, ball);
            checkCollision(cpu, ball);

            // 5. ç§»å‹•åˆ¶é™
            const margin = 5;
            player.y = Math.max(canvas.height / 2 + player.r, Math.min(canvas.height - margin, player.y));
            player.x = Math.max(player.r, Math.min(canvas.width - player.r, player.x));

            cpu.y = Math.max(margin, Math.min(canvas.height / 2 - cpu.r, cpu.y));
            cpu.x = Math.max(cpu.r, Math.min(canvas.width - cpu.r, cpu.x));
        }

        function checkCollision(p, b) {
            const dx = b.x - p.x;
            const dy = b.y - p.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const minDist = p.r + b.r;

            if (dist < minDist) {
                const angle = Math.atan2(dy, dx);
                const overlap = minDist - dist;

                b.x += Math.cos(angle) * overlap;
                b.y += Math.sin(angle) * overlap;

                const kickPower = 15;
                b.vx = Math.cos(angle) * kickPower;
                b.vy = Math.sin(angle) * kickPower;

                // ã‚«ãƒ¼ãƒ–
                b.vx += (Math.random() - 0.5) * 3;
            }
        }

        function checkGoalScore(scorer) {
            const bx = ball.x;
            const centerX = canvas.width / 2;
            const halfGoal = GOAL_WIDTH / 2;
            const isCenterGoal = (bx > centerX - halfGoal && bx < centerX + halfGoal);

            let points = 1;
            let msg = "GOAL!";

            if (isCenterGoal) {
                points = 2;
                msg = "SUPER GOAL!!";
                createConfetti();
            }

            if (scorer === 'player') {
                player.score += points;
                // è‡ªåˆ†ãŒå¾—ç‚¹ï¼šCPUã¯æ‚”ã—ãŒã‚Šã€è‡ªåˆ†ã¯å–œã¶
                showSpeech(cpuSpeechBubble, cpuSadPhrases, cpu, 'cpu');
                showSpeech(playerSpeechBubble, playerHappyPhrases, player, 'player');
            }
            else {
                cpu.score += points;
                // è‡ªåˆ†ãŒå¤±ç‚¹ï¼šè‡ªåˆ†ã¯æ‚”ã—ãŒã‚Šã€CPUã¯å–œã¶
                showSpeech(playerSpeechBubble, playerSadPhrases, player, 'player');
                showSpeech(cpuSpeechBubble, cpuHappyPhrases, cpu, 'cpu');
            }

            showGoalEffect(msg, points);
            updateScoreBoard();
            gameState = 'goal';
            canvas.classList.remove('no-cursor');

            setTimeout(() => {
                if (player.score >= TARGET_SCORE || cpu.score >= TARGET_SCORE) {
                    endGame();
                } else {
                    goalOverlay.classList.remove('show-goal');
                    resetPositions();
                    gameState = 'playing';
                    canvas.classList.add('no-cursor');
                    confettis = [];
                }
            }, 2000);
        }

        // --- ã‚»ãƒªãƒ•è¡¨ç¤ºæ©Ÿèƒ½ ---
        function showSpeech(element, phrases, charObj, type) {
            // ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚»ãƒªãƒ•ã‚’é¸æŠ
            const text = phrases[Math.floor(Math.random() * phrases.length)];
            element.innerText = text;

            // å¹ãå‡ºã—ã®ä½ç½®è¨­å®š
            element.style.left = charObj.x + 'px';

            if (type === 'cpu') {
                // CPUã¯ä¸‹ã«å¹ãå‡ºã—ã‚’å‡ºã™
                element.style.top = (charObj.y + 70) + 'px';
            } else {
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ä¸Šã«å¹ãå‡ºã—ã‚’å‡ºã™
                element.style.top = (charObj.y - 70 - 40) + 'px';
            }

            // è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            element.classList.remove('hidden');
            requestAnimationFrame(() => {
                element.classList.add('show-bubble');
            });

            // 2ç§’å¾Œã«æ¶ˆã™
            setTimeout(() => {
                element.classList.remove('show-bubble');
                setTimeout(() => {
                    element.classList.add('hidden');
                }, 200);
            }, 2000);
        }

        function showGoalEffect(title, pts) {
            goalTitle.innerText = title;
            goalPoints.innerText = "+" + pts;
            goalTitle.style.color = pts === 2 ? "#ffeb3b" : "#fff";
            goalOverlay.classList.add('show-goal');
        }

        function endGame() {
            goalOverlay.classList.remove('show-goal');
            confettis = [];
            gameState = 'gameover';
            canvas.classList.remove('no-cursor');

            const isWin = player.score > cpu.score;
            document.getElementById('result-title').innerText = isWin ? "YOU WIN!" : "YOU LOSE...";
            document.getElementById('result-title').style.color = isWin ? "#2e7d32" : "#d32f2f";

            resPlayerEl.innerText = player.score;
            resCPUEl.innerText = cpu.score;
            gameOverScreen.classList.remove('hidden');
        }

        // --- ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ ---
        function createConfetti() {
            confettis = [];
            for (let i = 0; i < 100; i++) {
                confettis.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 25,
                    vy: (Math.random() - 0.5) * 25,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    size: Math.random() * 12 + 5,
                    life: 100
                });
            }
        }

        function updateConfetti() {
            for (let i = confettis.length - 1; i >= 0; i--) {
                const c = confettis[i];
                c.x += c.vx;
                c.y += c.vy;
                c.vy += 0.6;
                c.vx *= 0.94;
                c.life--;
                if (c.life <= 0) confettis.splice(i, 1);
            }
        }

        function drawConfetti() {
            confettis.forEach(c => {
                ctx.fillStyle = c.color;
                ctx.fillRect(c.x, c.y, c.size, c.size);
            });
        }

        // --- å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆ ---
        window.addEventListener('keydown', e => { keys[e.key] = true; });
        window.addEventListener('keyup', e => { keys[e.key] = false; });

        function handleInput(x, y) {
            if (gameState === 'playing') {
                if (y > canvas.height / 2) {
                    player.x = x;
                    player.y = y;
                } else {
                    player.x = x;
                    player.y = canvas.height / 2 + player.r;
                }
            }
        }

        canvas.addEventListener('touchmove', e => {
            e.preventDefault();
            handleInput(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });

        canvas.addEventListener('touchstart', e => {
            e.preventDefault();
            handleInput(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });

        canvas.addEventListener('mousemove', e => {
            handleInput(e.clientX, e.clientY);
        });

        // ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ (é›£æ˜“åº¦å†é¸æŠã®ãŸã‚ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹)
        document.getElementById('retryBtn').onclick = () => {
            gameOverScreen.classList.add('hidden');
            menuScreen.classList.remove('hidden');
            gameState = 'menu';
            resetPositions();
            draw();
        };

        // --- æç”» ---
        function drawPitch() {
            // èŠç”Ÿ
            const stripeH = 60;
            for (let y = 0; y < canvas.height; y += stripeH) {
                ctx.fillStyle = (y / stripeH) % 2 < 1 ? '#2e7d32' : '#388e3c';
                ctx.fillRect(0, y, canvas.width, stripeH);
            }

            // ãƒ©ã‚¤ãƒ³
            ctx.strokeStyle = 'rgba(255,255,255,0.7)';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.rect(10, 10, canvas.width - 20, canvas.height - 20);
            ctx.moveTo(10, canvas.height / 2); ctx.lineTo(canvas.width - 10, canvas.height / 2);
            ctx.moveTo(canvas.width / 2 + 60, canvas.height / 2); ctx.arc(canvas.width / 2, canvas.height / 2, 60, 0, Math.PI * 2);

            const pW = 220, pH = 120;
            ctx.rect(canvas.width / 2 - pW / 2, 10, pW, pH);
            ctx.rect(canvas.width / 2 - pW / 2, canvas.height - 10 - pH, pW, pH);
            ctx.stroke();

            // 2ç‚¹ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢
            const gW = GOAL_WIDTH;
            ctx.fillStyle = 'rgba(255, 235, 59, 0.25)';
            ctx.fillRect(canvas.width / 2 - gW / 2, 0, gW, 10);
            ctx.fillRect(canvas.width / 2 - gW / 2, canvas.height - 10, gW, 10);

            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 6;
            ctx.strokeRect(canvas.width / 2 - gW / 2, 0, gW, 10);
            ctx.strokeRect(canvas.width / 2 - gW / 2, canvas.height - 10, gW, 10);

            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText("SUPER GOAL", canvas.width / 2, 45);
            ctx.fillText("SUPER GOAL", canvas.width / 2, canvas.height - 35);
        }

        function draw() {
            drawPitch();

            ctx.save();
            ctx.translate(ball.x, ball.y);
            ctx.rotate(ball.angle);
            ctx.drawImage(imgBall, -ball.r, -ball.r, ball.r * 2, ball.r * 2);
            ctx.restore();

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
            ctx.save();
            // ä¸¸ãåˆ‡ã‚ŠæŠœã
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.r, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip();
            // ç”»åƒæç”»
            ctx.drawImage(imgDog1, player.x - player.r, player.y - player.r, player.r * 2, player.r * 2);
            ctx.restore();

            // CPU (åŒã˜å‘ãã«å¤‰æ›´)
            ctx.save();
            ctx.translate(cpu.x, cpu.y);
            // ä¸¸ãåˆ‡ã‚ŠæŠœã
            ctx.beginPath();
            ctx.arc(0, 0, cpu.r, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip();
            // ç”»åƒæç”»
            ctx.drawImage(imgDog2, -cpu.r, -cpu.r, cpu.r * 2, cpu.r * 2);
            ctx.restore();

            if (gameState === 'goal') {
                updateConfetti();
                drawConfetti();
            }
        }

        function loop() {
            if (gameState !== 'menu') {
                update();
                draw();
            }
            requestAnimationFrame(loop);
        }

        resize();
        resetPositions();
        draw();

    </script>
</body>

</html>